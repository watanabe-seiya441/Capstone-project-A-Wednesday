<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Main</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="css/sanitize.css">
        <link rel="stylesheet" href="css/main.css">
        

        <!-- D3 v3をd3としてインポート  -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://d3js.org/d3.v3.min.js"></script>
        <script src="https://d3js.org/topojson.v1.min.js"></script>
        <script src="https://d3js.org/queue.v1.min.js"></script>
        <script src="https://d3js.org/colorbrewer.v1.min.js"></script>
        <script>
            var d3v3 = d3; // D3 v3をd3v3としてインポート
            d3 = null;
        </script>

        <!-- D3 v7をd3としてインポート -->
        <script type="text/javascript" src="./js/d3.min.js"></script>
        <script type="text/javascript" src="./js/topojson.js" charset="utf-8"></script>

        <!-- カルトグラムを書く関数をインポート -->
        <script src="./cartogram/d3_cartogram/cartogram.js"></script>

    </head>

    <body>
        <div id="loading" class="loading">
            <div class="drop"></div>
            <div class="wave"></div>
            <img src="./resources/icon_goals06_tr.png" style="position: fixed; left: 50%; transform: translateX(-50%) scale(0.30); z-index: 9999;">
        </div>
        <!-- <script src="./js/createCartogramWorldMap.js"></script> -->

        <!-- <div id="mapWrapper"> -->
        <!-- 文字の位置を制御-->
        <div id="MainWindow">
            <div  style="position: absolute; top: 0; left: 0; width: 600px; height: 700px;">
                <!-- 世界地図を作成 ここのdivコメントアウトするとカルトグラム-->
                <div class="UpperLeftWindow" id="WorldMap" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; margin:15px; background-color: #f7f3ed;">  
                </div>

            </div>

            <div  style="position: absolute; top: 0; left: 615px; width: 600px; height: 210px;">
                <div class="UpperRightWindow" id="ThreeCircles" style="height: 100%; width:100%; margin:15px; background-color: white;">
                    <!-- 国の詳細ページのボタンを追加 -->
                    <button class="button Mainbotton" onclick="redirectToCountryDetail()" style="z-index: 100; position: absolute; left: 19px; top: 100px;">注目している国の詳細を見る</button>
                </div>
            </div>

            <div style="position: absolute; top: 215px; left: 615px; width: 600px; height: 480px;">
                <div class="DownWindow" id="News" style="height: 100%; width:100%; margin:15px; background-color: white;  overflow:auto">
                    <div>
                        <h3 style="margin:1em;">News</h3>
                        <ol id = "NewsContent" role="list">
                            <li>
                                <div style="display:flex;">
                                    <h3>News Title</h3>
                                    <span class="countryName">Japan</span>
                                    <span class="date">2023-01-01</span>
                                </div>
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Adipiscing diam donec adipiscing tristique risus.</p>
                            </li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        <script>
            var link = document.createElement('link');
              link.rel = 'stylesheet';
              link.href = 'css/loading.css';
              document.head.appendChild(link);
          window.onload = function() {
              var h = window.innerHeight;
              var img = document.querySelector('#loading img');
              img.style.bottom = (h / 4 - img.offsetHeight / 2) * 0.8 + 'px';
              
              // 3秒後にフェードアウトを開始
              setTimeout(function() {
                  var opacity = 1; // 初期の透明度
                  var timer = setInterval(function() {
                      if (opacity <= 0){
                          clearInterval(timer);
                          img.style.display = 'none'; // 透明度が0になったら画像を非表示にする
                      }
                      img.style.opacity = opacity;
                      opacity -= 0.1; // 透明度を0.1ずつ下げる
                  }, 50); // 100msごとに透明度を下げる
          
              }, 2200); // 2.2秒後にフェードアウトを開始
              document.body.style.backgroundColor = '#e5e8ec'; // ローディング後の背景色に変更
              // 3秒後にローディング画面を非表示にし、背景色を変更
              setTimeout(function() {
                  var loadingDiv = document.getElementById('loading');
                  loadingDiv.style.display = 'none';
                  // 次の描画フレームでloading.cssを削除
                  requestAnimationFrame(function() {
                      var loadingCss = document.querySelector('link[href="css/loading.css"]');
                      loadingCss.parentNode.removeChild(loadingCss);
                  });
              }, 4000);
          };
      </script>
        <script type="module" src="./js/SplitScreen.js"></script>
        <script type="text/javascript">
            function redirectToCountryDetail() {
                const year = document.getElementsByClassName("year")[0].textContent;
                const country = document.getElementsByClassName("countryName")[0].value;
                window.location.href = `countryDetail.html?country=${encodeURIComponent(country)}&year=${encodeURIComponent(year)}`;
            }
        </script>
    </body>

</html>